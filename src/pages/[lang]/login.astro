---
import BaseLayout from '../../layouts/BaseLayout.astro';
import AuthForm from '../../components/AuthForm.jsx';
import { useTranslations } from '../../i18n/utils';
import { createSupabaseServerClient } from '../../lib/supabase-server';

export const prerender = false;

export async function getStaticPaths() {
    return [
        { params: { lang: 'es' } },
        { params: { lang: 'en' } },
        { params: { lang: 'ru' } }
    ];
}

const { lang } = Astro.params;
const t = useTranslations(lang);

// Check if user is already logged in
const supabase = createSupabaseServerClient(Astro);
const { data: { user } } = await supabase.auth.getUser();

if (user) {
    return Astro.redirect(`/api/auth/post-login?lang=${lang}`);
}

// We pass the whole translation object for the current language to the React component
// because the React component cannot use the Astro-side helper directly in client-side mode easily without prop drilling.
// We'll pass the 't' function result for specific keys or a subset.
// Actually, 't' returns strings. The component expects a dictionary.
// Let's import the 'ui' object directly to pass the specific language part.
import { ui } from '../../i18n/translations';
const currentLangTranslations = ui[lang];
---

<BaseLayout 
    title={`${t('auth.login')} | EspaÃ±ol Honesto`} 
    description={t('meta.description')} 
    lang={lang}
    noindex={true}
>
    <div class="min-h-screen bg-[#E0F7FA] flex items-center justify-center p-4">
        <AuthForm client:load lang={lang} translations={currentLangTranslations} />
    </div>
</BaseLayout>
